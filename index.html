<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padelucky - Máquina de la Suerte</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            margin-top: 50px;
        }
        h1 {
            color: #333;
        }
        .machine {
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
        }
        .number-input {
            margin: 10px 0;
        }
        .number-input input {
            width: 50px;
            padding: 10px;
            text-align: center;
            font-size: 16px;
        }
        .number-list, .ticket-table, .verifier {
            margin: 20px 0;
        }
        .number-list span {
            display: inline-block;
            background: #ffcc00;
            color: #333;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            font-size: 18px;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 80%;
            max-width: 500px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: center;
            cursor: pointer;
        }
        th {
            background-color: #f2f2f2;
        }
        .selected {
            background-color: #ffcc00 !important;
        }
        .button {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            background: #28a745;
            color: #fff;
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
        }
        .button:hover {
            background: #218838;
        }
        #formModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        #formModal .form-container {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 400px;
        }
        #formModal .form-container input {
            width: calc(100% - 22px);
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #formModal .form-container button {
            width: 100%;
            padding: 10px;
            background: #28a745;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        #formModal .form-container button:hover {
            background: #218838;
        }
        .verifier input {
            padding: 10px;
            width: 150px;
            margin: 10px;
            text-align: center;
            font-size: 16px;
        }
        #accessModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        #accessModal .form-container {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 400px;
        }
        #accessModal .form-container input {
            width: calc(100% - 22px);
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #accessModal .form-container button {
            width: 100%;
            padding: 10px;
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        #accessModal .form-container button:hover {
            background: #0056b3;
        }
        #adminModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        #adminModal .form-container {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 600px;
        }
        #adminModal .form-container input {
            width: calc(100% - 22px);
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #adminModal .form-container button {
            width: 100%;
            padding: 10px;
            background: #ffc107;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        #adminModal .form-container button:hover {
            background: #e0a800;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>¡Bienvenidos a Padelucky!</h1>
        <p>Edición #1 Adidas Metalbone HRD 2024 Ale Galán, participa con nuestra máquina de la suerte - Sorteo 1ro de julio</p>
        <div class="machine">
            <div class="number-input">
                <label for="numTickets">¿Cuántos números quieres?</label>
                <input type="number" id="numTickets" min="1" max="149" value="1">
            </div>
            <button class="button" onclick="generateNumbers()">La Máquina de la Suerte</button>
            <div class="number-list" id="numberList"></div>
            <div id="totalCost"></div>
            <a id="apartButton" class="button" href="#" style="display: none;" onclick="showForm()">Apartar</a>
        </div>
        <div class="ticket-table">
            <h2>Boletos Disponibles</h2>
            <table id="availableTicketsTable">
                <tbody id="availableTicketsBody">
                </tbody>
            </table>
        </div>
        <div class="verifier">
            <h2>Verificar Boleto</h2>
            <input type="number" id="verifyTicket" min="1" max="149" placeholder="Número de boleto">
            <button class="button" onclick="verifyTicket()">Verificar</button>
            <p id="verifyResult"></p>
        </div>
        <button class="button" onclick="showAccess()">Acceso</button>
    </div>

    <div id="formModal">
        <div class="form-container">
            <h2>Apartar Boleto(s)</h2>
            <input type="text" id="customerName" placeholder="Nombre Completo" required>
            <input type="tel" id="customerPhone" placeholder="Número de Celular" required>
            <input type="text" id="customerState" placeholder="Estado de Residencia" required>
            <button onclick="submitForm()">Enviar</button>
        </div>
    </div>

    <div id="accessModal">
        <div class="form-container">
            <h2>Acceso</h2>
            <input type="password" id="adminPassword" placeholder="Contraseña" required>
            <button onclick="validateAccess()">Entrar</button>
        </div>
    </div>

    <div id="adminModal">
        <div class="form-container">
            <h2>Boletos Apartados</h2>
            <input type="number" id="searchTicket" placeholder="Buscar Boleto">
            <button onclick="searchBookedTicket()">Buscar</button>
            <table id="bookedTicketsTable">
                <thead>
                    <tr>
                        <th>Número de Boleto</th>
                        <th>Nombre</th>
                        <th>Teléfono</th>
                        <th>Estado</th>
                        <th>Reactivar</th>
                    </tr>
                </thead>
                <tbody id="bookedTicketsBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let selectedNumbers = [];
        const totalTickets = 149;
        const bookedTickets = {};
        const ticketPrice = 99;

        function generateNumbers() {
            const numTickets = parseInt(document.getElementById('numTickets').value);
            selectedNumbers = [];
            for (let i = 0; i < numTickets; i++) {
                let randomNum;
                do {
                    randomNum = Math.floor(Math.random() * totalTickets) + 1;
                } while (selectedNumbers.includes(randomNum) || bookedTickets[randomNum]);
                selectedNumbers.push(randomNum);
            }
            updateNumberList();
        }

        function updateAvailableTicketsTable() {
            const availableTicketsBody = document.getElementById('availableTicketsBody');
            availableTicketsBody.innerHTML = '';
            let tr;
            for (let i = 1; i <= totalTickets; i++) {
                if ((i - 1) % 12 === 0) {
                    tr = document.createElement('tr');
                }
                const td = document.createElement('td');
                td.textContent = String(i).padStart(3, '0');
                if (!bookedTickets[i]) {
                    td.onclick = () => selectTicket(i, td);
                } else {
                    td.style.backgroundColor = "#ddd";
                }
                tr.appendChild(td);
                if (i % 12 === 0) {
                    availableTicketsBody.appendChild(tr);
                }
            }
            if (totalTickets % 12 !== 0) {
                availableTicketsBody.appendChild(tr);
            }
        }

        function selectTicket(ticketNumber, td) {
            if (!selectedNumbers.includes(ticketNumber)) {
                selectedNumbers.push(ticketNumber);
                td.classList.add('selected');
                td.onclick = () => deselectTicket(ticketNumber, td);
                updateNumberList();
            }
        }

        function deselectTicket(ticketNumber, td) {
            selectedNumbers = selectedNumbers.filter(num => num !== ticketNumber);
            td.classList.remove('selected');
            td.onclick = () => selectTicket(ticketNumber, td);
            updateNumberList();
        }

        function updateNumberList() {
            const numberListDiv = document.getElementById('numberList');
            numberListDiv.innerHTML = '';
            selectedNumbers.forEach(num => {
                const span = document.createElement('span');
                span.textContent = String(num).padStart(3, '0');
                numberListDiv.appendChild(span);
            });

            const apartButton = document.getElementById('apartButton');
            const totalCostDiv = document.getElementById('totalCost');
            if (selectedNumbers.length > 0) {
                apartButton.style.display = 'inline-block';
                const totalCost = selectedNumbers.length * ticketPrice;
                totalCostDiv.textContent = `Costo Total: $${totalCost} MXN`;
            } else {
                apartButton.style.display = 'none';
                totalCostDiv.textContent = '';
            }
        }

        function showForm() {
            document.getElementById('formModal').style.display = 'flex';
        }

        function submitForm() {
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const customerState = document.getElementById('customerState').value;

            if (!customerName || !customerPhone || !customerState) {
                alert('Por favor, complete todos los campos.');
                return;
            }

            selectedNumbers.forEach(ticketNumber => {
                bookedTickets[ticketNumber] = {
                    name: customerName,
                    phone: customerPhone,
                    state: customerState
                };
            });

            const message = `${customerName}\nBoleto(s) No. ${selectedNumbers.join(', ')} apartado(s)\nAl Aceptar, estarás de acuerdo con los términos y condiciones del sorteo y serás direccionado a WhatsApp, favor de mandar su pago para recibir sus boletos.`;
            alert(message);

            const whatsappUrl = `https://wa.me/526647185248?text=${encodeURIComponent(message)}%0AUNICAMENTE%20MANDE%20SU%20COMPROBANTE%20DE%20PAGO%20AQUI%20EN%20ESTA%20LINEA%20Y%20ESPERE%20SU%20TURNO%20✅️%20⚠️%20REVISE%20CUANTOS%20BOLETOS%20APARTO%20Y%20SOLO%20PAGUE%20LA%20CANTIDAD%20CORRECTA.%20*Apartado%20valido%20por%203%20horas`;
            window.location.href = whatsappUrl;

            document.getElementById('formModal').style.display = 'none';
            selectedNumbers = [];
            updateNumberList();
            updateAvailableTicketsTable();
        }

        function verifyTicket() {
            const ticketNumber = parseInt(document.getElementById('verifyTicket').value);
            const verifyResult = document.getElementById('verifyResult');

            if (bookedTickets[ticketNumber]) {
                const {name, phone, state} = bookedTickets[ticketNumber];
                verifyResult.textContent = `Boleto No. ${String(ticketNumber).padStart(3, '0')} - Apartado por: ${name}, Tel: ${phone}, Estado: ${state}`;
            } else {
                verifyResult.textContent = `Boleto No. ${String(ticketNumber).padStart(3, '0')} está disponible.`;
            }
        }

        function showAccess() {
            document.getElementById('accessModal').style.display = 'flex';
        }

        function validateAccess() {
            const password = document.getElementById('adminPassword').value;
            if (password === "560$Iimams") {
                document.getElementById('accessModal').style.display = 'none';
                showAdminPanel();
            } else {
                alert('Contraseña incorrecta');
            }
        }

        function showAdminPanel() {
            document.getElementById('adminModal').style.display = 'flex';
            updateBookedTicketsTable();
        }

        function updateBookedTicketsTable() {
            const bookedTicketsBody = document.getElementById('bookedTicketsBody');
            bookedTicketsBody.innerHTML = '';
            for (const [ticketNumber, {name, phone, state}] of Object.entries(bookedTickets)) {
                const tr = document.createElement('tr');
                const tdNumber = document.createElement('td');
                tdNumber.textContent = String(ticketNumber).padStart(3, '0');
                const tdName = document.createElement('td');
                tdName.textContent = name;
                const tdPhone = document.createElement('td');
                tdPhone.textContent = phone;
                const tdState = document.createElement('td');
                tdState.textContent = state;
                const tdReactivate = document.createElement('td');
                const reactivateButton = document.createElement('button');
                reactivateButton.textContent = 'Reactivar';
                reactivateButton.onclick = () => reactivateTicket(ticketNumber);
                tdReactivate.appendChild(reactivateButton);
                tr.appendChild(tdNumber);
                tr.appendChild(tdName);
                tr.appendChild(tdPhone);
                tr.appendChild(tdState);
                tr.appendChild(tdReactivate);
                bookedTicketsBody.appendChild(tr);
            }
        }

        function searchBookedTicket() {
            const searchTicket = parseInt(document.getElementById('searchTicket').value);
            const bookedTicketsBody = document.getElementById('bookedTicketsBody');
            for (let row of bookedTicketsBody.rows) {
                if (parseInt(row.cells[0].textContent) === searchTicket) {
                    row.scrollIntoView();
                    row.style.backgroundColor = "#ffcc00";
                } else {
                    row.style.backgroundColor = "";
                }
            }
        }

        function reactivateTicket(ticketNumber) {
            delete bookedTickets[ticketNumber];
            updateBookedTicketsTable();
            updateAvailableTicketsTable();
        }

        window.onload = function() {
            updateAvailableTicketsTable();
        };
    </script>
</body>
</html>
